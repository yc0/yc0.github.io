<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: true,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Configuration management systemDesign a configuration management system User should be able to add configuration User should be able to delete configuration User should be able to search for configura">
<meta name="keywords" content="system design,amazon,onsite">
<meta property="og:type" content="article">
<meta property="og:title" content="Design a configuration management system">
<meta property="og:url" content="http://yoursite.com/2019/10/22/Design-a-configuration-management-system/index.html">
<meta property="og:site_name" content="YC Note">
<meta property="og:description" content="Configuration management systemDesign a configuration management system User should be able to add configuration User should be able to delete configuration User should be able to search for configura">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-11-14T23:28:02.829Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Design a configuration management system">
<meta name="twitter:description" content="Configuration management systemDesign a configuration management system User should be able to add configuration User should be able to delete configuration User should be able to search for configura">
  <link rel="canonical" href="http://yoursite.com/2019/10/22/Design-a-configuration-management-system/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Design a configuration management system | YC Note</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YC Note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
      
        
          
        
      
        
      
        
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">15</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
      
        
      
        
      
        
          
        
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">20</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
      
        
      
        
          
        
      
        
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">12</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-schedule">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/schedule/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>Schedule</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-sitemap">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>Sitemap</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/22/Design-a-configuration-management-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nelson">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YC Note">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Design a configuration management system

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-10-22 16:40:02" itemprop="dateCreated datePublished" datetime="2019-10-22T16:40:02+08:00">2019-10-22</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-15 07:28:02" itemprop="dateModified" datetime="2019-11-15T07:28:02+08:00">2019-11-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/system-design/" itemprop="url" rel="index"><span itemprop="name">system design</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Configuration-management-system"><a href="#Configuration-management-system" class="headerlink" title="Configuration management system"></a>Configuration management system</h2><p>Design a configuration management system</p><ul>
<li>User should be able to add configuration</li>
<li>User should be able to delete configuration</li>
<li>User should be able to search for configuration</li>
<li>User should be able to subscribe to Configuration So that any updates in configuration will gets notfied to user</li>
</ul><a id="more"></a>

<h3 id="Clarify"><a href="#Clarify" class="headerlink" title="Clarify"></a>Clarify</h3><p>We want to design a system to persist configurations that can be used by other systems. Configurations will be managed through an internal portal and will be editable only by the user who created them but can be read by any system through a RESTful API. In addition to CRUD (creation, read, updates and deletions) an user can search for configurations and can subscribe to them to receive notifications every time there’s a change.</p>
<p>This is how I’d go about it (since I don’t have an interviewer to ask questions to, these numbers are made up):</p>
<h3 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h3><ul>
<li>Let’s say we have 500M total users and 50M daily active users</li>
<li>There are 1M new configurations created every day on average</li>
<li>We get 100M reads of the configurations every day on average</li>
<li>Updates are infrequent but they happen: 10k a day on average</li>
<li>Deletions are even more infrequent: 5k a day on average</li>
<li>Each active user performs 2 searches a day on average</li>
<li>5k subscriptions every day, 0.5k unsubscriptions a day on average</li>
<li>Configurations are JSON files that are 1kb in size on average</li>
<li>Following the CAP theorem, we can argue that we are interested in an AP system (highly available, partitioned and eventually consistent).</li>
</ul>
<p>With this data, I’d do some back-of-the-envelope math:</p>
<ul>
<li>Traffic: Calculate the read TPS and write TPS.</li>
<li>Bandwidth: download and upload bandwidth necessary to serve the content</li>
<li>Memory: how much memory we are going to need to store 5 and 10 years of configurations * (see below for this)</li>
<li>Cache: following the 80/20 rule, calculate how much memory we need to store 20% of daily configurations * (see below for this)</li>
</ul>
<p>To do number 3 and 4, we should sketch the models:</p>
<p><code>Configuration Table:</code></p>
<ul>
<li>ConfigurationID</li>
<li>ConfigurationName</li>
<li>OwnerID</li>
<li>ConfigurationURI</li>
<li>CreationTimestamp</li>
</ul>
<p>We should estimate the length in bytes of the configuration ID to be able to hold 10 years of IDs. Same for ownerID.<br>Now that we’ve done some math, we probably found out the following:</p>
<ol>
<li>The system is VERY read heavy:<ul>
<li>Probably a good approach would be to have master write DBs where the changes are propagated to the slave read DBs.</li>
<li>Cache will benefit us immensely. Talk about eviction strategies.</li>
</ul>
</li>
<li>The TPS will help us figure out how many web servers we need.</li>
<li>The memory will probably tell us that we need sharding. Discuss here sharding strategies and No SQL vs SQL databases.</li>
</ol>
<p>Quickly sketch the APIs of the system and their parameters. At least we need the following APIs:</p>
<ul>
<li>CreateConfiguration</li>
<li>UpdateConfiguration</li>
<li>DeleteConfiguration</li>
<li>ReadConfiguration</li>
<li>SearchConfigurations</li>
<li>SubscribeToConfiguration</li>
<li>UnsubscribeFromConfiguration</li>
</ul>
<p>After this, draw a HIGH LEVEL diagram (without scaling, load balancing, redundancy, cache etc.) to trace a request for each API:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">                     |-----&gt; IndexService --------v</span><br><span class="line">User --&gt; Web<span class="built_in"> Server </span>--&gt; ConfigurationService --&gt; Database</span><br><span class="line">                     |-----&gt; Cloud Storage</span><br></pre></td></tr></table></figure>

<p>After that, we can move on to a detailed design:</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">U<span class="function"><span class="title">ser</span> --&gt;</span> L<span class="function"><span class="title">oadBalancer</span> --&gt;</span> [W<span class="function"><span class="title">ebServer1</span>, WebServer2, ...] --&gt;</span> L<span class="function"><span class="title">oad</span> Balancer --&gt;</span> [C<span class="function"><span class="title">onfigurationService1</span>, ConfigurationService2,...] --&gt;</span> C<span class="function"><span class="title">ache</span> --&gt;</span> M<span class="function"><span class="title">asterDatabases</span> --&gt;</span> SlaveDatabases</span><br></pre></td></tr></table></figure>

<h3 id="At-least-Cover-the-following"><a href="#At-least-Cover-the-following" class="headerlink" title="At least Cover the following"></a>At least Cover the following</h3><ol>
<li>Load balancing and mention a couple of LB algorithms</li>
<li>What we’re storing in the cache</li>
<li>What happens when Load Balancers die and how do you detect it</li>
<li>Redundancy: how we can guarantee that we wont lose any configurations</li>
<li>What happens when there’s a spike of reads because it’s Black Friday on Amazon</li>
<li>What happens if a Master Database dies</li>
<li>What happens if a slave database dies</li>
<li>What happens if the cache dies</li>
<li>Do we need a CDN?</li>
<li>How can we prevent users from storing highly sensitive data in there? Like Credit Card numbers.</li>
<li>What happens if a datacenter goes down? Can we recover from that? How?</li>
<li>Can we compress the configurations? How much space is that going to save? What’s the impact in latency when reading a new configuration?</li>
<li>How can we throttle a user that wrote a buggy script and is creating configurations like crazy (and will consume all IDs)?</li>
<li>What metrics are you going to monitor?</li>
<li>Where do you store the logs? How often do you rotate them?</li>
<li>What alarming are you going to put in place?</li>
</ol>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/system-design/" rel="tag"># system design</a>
            
              <a href="/tags/amazon/" rel="tag"># amazon</a>
            
              <a href="/tags/onsite/" rel="tag"># onsite</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/10/18/System-Design-Overview/" rel="next" title="System Design Overview">
                  <i class="fa fa-chevron-left"></i> System Design Overview
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/10/23/Design-a-Vending-Machine/" rel="prev" title="Design a Vending Machine">
                  Design a Vending Machine <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Configuration-management-system"><span class="nav-number">1.</span> <span class="nav-text">Configuration management system</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Clarify"><span class="nav-number">1.1.</span> <span class="nav-text">Clarify</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assumptions"><span class="nav-number">1.2.</span> <span class="nav-text">Assumptions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#At-least-Cover-the-following"><span class="nav-number">1.3.</span> <span class="nav-text">At least Cover the following</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Nelson</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/yc0" title="GitHub &rarr; https://github.com/yc0" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:nelson.lin.tw@gmail.com" title="E-Mail &rarr; mailto:nelson.lin.tw@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nelson</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script src="/lib/pjax/pjax.min.js?v=0.2.8"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>
<script src="/js/next-boot.js?v=7.4.0"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var id = element.id || '';
    var src = element.src || '';
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (id !=='') {
      script.id = element.id;
    }
    if (src !== '') {
      script.src = src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




















    <div id="pjax">

  

  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'a5fc1ce139416ecb08cd',
      clientSecret: '7c25b43f328e1e82fc5661a5d51f0f6b14ab1d0d',
      repo: 'yc0.github.io',
      owner: 'yc0',
      admin: ['yc0'],
      id: 'cc081ab7ec06cf8bcfe3aed3e2f87f83',
        language: window.navigator.language || window.navigator.userLanguage,
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

    </div>
</body>
</html>
